
var JSON;if(!JSON){JSON={};}
(function(){'use strict';function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());(function(p,z){function q(a){return!!(""===a||a&&a.charCodeAt&&a.substr)}function m(a){return u?u(a):"[object Array]"===v.call(a)}function r(a){return"[object Object]"===v.call(a)}function s(a,b){var d,a=a||{},b=b||{};for(d in b)b.hasOwnProperty(d)&&null==a[d]&&(a[d]=b[d]);return a}function j(a,b,d){var c=[],e,h;if(!a)return c;if(w&&a.map===w)return a.map(b,d);for(e=0,h=a.length;e<h;e++)c[e]=b.call(d,a[e],e,a);return c}function n(a,b){a=Math.round(Math.abs(a));return isNaN(a)?b:a}function x(a){var b=c.settings.currency.format;"function"===typeof a&&(a=a());return q(a)&&a.match("%v")?{pos:a,neg:a.replace("-","").replace("%v","-%v"),zero:a}:!a||!a.pos||!a.pos.match("%v")?!q(b)?b:c.settings.currency.format={pos:b,neg:b.replace("%v","-%v"),zero:b}:a}var c={version:"0.3.2",settings:{currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}}},w=Array.prototype.map,u=Array.isArray,v=Object.prototype.toString,o=c.unformat=c.parse=function(a,b){if(m(a))return j(a,function(a){return o(a,b)});a=a||0;if("number"===typeof a)return a;var b=b||".",c=RegExp("[^0-9-"+b+"]",["g"]),c=parseFloat((""+a).replace(/\((.*)\)/,"-$1").replace(c,"").replace(b,"."));return!isNaN(c)?c:0},y=c.toFixed=function(a,b){var b=n(b,c.settings.number.precision),d=Math.pow(10,b);return(Math.round(c.unformat(a)*d)/d).toFixed(b)},t=c.formatNumber=function(a,b,d,i){if(m(a))return j(a,function(a){return t(a,b,d,i)});var a=o(a),e=s(r(b)?b:{precision:b,thousand:d,decimal:i},c.settings.number),h=n(e.precision),f=0>a?"-":"",g=parseInt(y(Math.abs(a||0),h),10)+"",l=3<g.length?g.length%3:0;return f+(l?g.substr(0,l)+e.thousand:"")+g.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+e.thousand)+(h?e.decimal+y(Math.abs(a),h).split(".")[1]:"")},A=c.formatMoney=function(a,b,d,i,e,h){if(m(a))return j(a,function(a){return A(a,b,d,i,e,h)});var a=o(a),f=s(r(b)?b:{symbol:b,precision:d,thousand:i,decimal:e,format:h},c.settings.currency),g=x(f.format);return(0<a?g.pos:0>a?g.neg:g.zero).replace("%s",f.symbol).replace("%v",t(Math.abs(a),n(f.precision),f.thousand,f.decimal))};c.formatColumn=function(a,b,d,i,e,h){if(!a)return[];var f=s(r(b)?b:{symbol:b,precision:d,thousand:i,decimal:e,format:h},c.settings.currency),g=x(f.format),l=g.pos.indexOf("%s")<g.pos.indexOf("%v")?!0:!1,k=0,a=j(a,function(a){if(m(a))return c.formatColumn(a,f);a=o(a);a=(0<a?g.pos:0>a?g.neg:g.zero).replace("%s",f.symbol).replace("%v",t(Math.abs(a),n(f.precision),f.thousand,f.decimal));if(a.length>k)k=a.length;return a});return j(a,function(a){return q(a)&&a.length<k?l?a.replace(f.symbol,f.symbol+Array(k-a.length+1).join(" ")):Array(k-a.length+1).join(" ")+a:a})};if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports)exports=module.exports=c;exports.accounting=c}else"function"===typeof define&&define.amd?define([],function(){return c}):(c.noConflict=function(a){return function(){p.accounting=a;c.noConflict=z;return c}}(p.accounting),p.accounting=c)})(this);$j=jQuery.noConflict();$j(document).ready(function(){$j(this).modal();});(function($){var resizeHeight=false;var methods={init:function(){$('.window .close').click(function(e){e.preventDefault();$('body').css('overflow-y','inherit');$('#mask, .window').hide();});$(document).keyup(function(e){if(e.keyCode==27){$('body').css('overflow-y','inherit');$('#mask, .window').hide();}});$(window).resize(function(){methods.resizeModal();});$('#mask').click(function(){$('body').css('overflow-y','inherit');$(this).hide();$('.window').hide();});methods.resizeModal();},resizeModal:function(){var box=$('#boxes .window');var maskHeight=$(document).height();var maskWidth=$(window).width();$('#mask').css({'width':maskWidth,'height':maskHeight,'left':0,'top':0});var winH=$(window).height();var winW=$(window).width();box.css('top',winH/2-box.height()/2);box.css('left',winW/2-box.width()/2);if(resizeHeight){var windowHeight=winH-100;if(windowHeight>600){windowHeight=600;}
box.css('height',windowHeight+"px");var div=$('#boxes .resizable');div.css('height',(windowHeight-60)+"px");}},displayModal:function(){$('body').css('overflow-y','hidden');methods.resizeModal();var modalId='#dialog';var maskHeight=$(document).height();var maskWidth=$(window).width();$('#mask').css({'width':maskWidth,'height':maskHeight,'left':0,'top':0});$('#mask').fadeTo("fast",0.8);var winH=$(window).height();var winW=$(window).width();$(modalId).css('top',winH/2-$(modalId).height()/2);$(modalId).css('left',winW/2-$(modalId).width()/2);$(modalId).fadeIn(100);}};$.fn.modal=function(method,allowHeightResize){resizeHeight=allowHeightResize;if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.tooltip');}};})(jQuery);(function($){$.fn.stackOnWrap=function(options){var settings,spans,line,span;settings=$.extend({innerElements:'span',factor:2},options);spans=$(this).find(settings.innerElements);line=Math.floor(parseInt(spans.css('font-size').replace('px',''))*settings.factor);span=$(this).height();if(span>line){spans.each(function(i,el){el.outerHTML='<div>'+el.outerHTML+'</div>';});}};})(jQuery.noConflict());var ajaxWin={contents:'',json:[],loaded:false,show:function(json){ajaxWin.json=json;ajaxWin.buildContents();if(this.loaded){ajaxWin.activateWindow();}else{Event.observe(window,'load',ajaxWin.activateWindow);};},buildContents:function(){var json=ajaxWin.json;ajaxWin.contents='<a onclick="'+(json.cnclFunc?json.cnclFunc:'')+' ajaxWin.cancelWindow(); return false" class="close_btn" title="'+(json.cnclText?json.cnclText:'Cancel')+'" ></a>';ajaxWin.contents+='<div class="hdr" id="ajaxWinHdr">';if(json.title){ajaxWin.contents+=json.title;};ajaxWin.contents+='</div>';ajaxWin.contents+='<div id="ajaxWinBody">';if(json.hdrTxt||json.hdrIcon){ajaxWin.contents+='<table class="ndnt">';ajaxWin.contents+='<tr>';if(json.hdrIcon){ajaxWin.contents+='<td class="m"><img src="'+json.hdrIcon+'" alt="" style="padding-right:6px" /></td>';};ajaxWin.contents+='<td class="m"><strong class="'+json.hdrTxtClass+'">'+json.hdrTxt+'</strong></td>';ajaxWin.contents+='</tr>';ajaxWin.contents+='</table>';};ajaxWin.contents+=json.cntnt;ajaxWin.contents+='</div>';if(json.footer){ajaxWin.contents+='<div class="clear"></div>';ajaxWin.contents+='<div id="ajaxWinFtr" class="ftr">';ajaxWin.contents+=json.footer;ajaxWin.contents+='</div>';};},activateWindow:function(){var json=ajaxWin.json;var ins;if(!json.contentDiv){var content='cntnt';}else{var content=json.contentDiv;}
if(!$('ajaxWin')){ins=new Insertion.Bottom(content,'<div id="ajaxWinBG" style="display:none;" ></div>');ins=new Insertion.Bottom(content,'<div id="ajaxWin" class="dropshadow" style="display:none;" ><div id = "ajaxWinWrapper">'+ajaxWin.contents+'</div></div>');}else{$('ajaxWin').hide();$('ajaxWinWrapper').update(ajaxWin.contents);};if(typeof(json.wdth)!='undefined'){$('ajaxWin').style.width=json.wdth+10+'px';};var w=$('ajaxWin').getWidth();var h=$('ajaxWin').getHeight();var viewportDims=document.viewport.getDimensions();var scrollOffsets=document.viewport.getScrollOffsets();$('ajaxWinBG').style.width=(viewportDims.width*3)+scrollOffsets.left+'px';$('ajaxWinBG').style.height=(viewportDims.height*3)+scrollOffsets.top+'px';$('ajaxWin').style.top=Math.max(0,parseInt((viewportDims.height/2)-(h/2)+scrollOffsets.top,10))+'px';$('ajaxWin').style.left=Math.max(0,parseInt((viewportDims.width/2)-(w/2)+scrollOffsets.left,10))+'px';$('ajaxWinBG').show();$('ajaxWin').show();var draggable=new Draggable('ajaxWin',{handle:'ajaxWinHdr'});if(draggable){$('ajaxWinHdr').setStyle('cursor:move');}
Event.observe(document,'keypress',function(e){if(e.keyCode==27){ajaxWin.cancelWindow();}});document.fire('ajax_widget_window:open');},cancelWindow:function(){if($('ajaxWin')){$('ajaxWin').remove();}
if($('ajaxWinBG')){$('ajaxWinBG').remove();}
document.fire('ajax_widget_window:closed');Event.stopObserving(document,'keypress');}};Event.observe(window,'load',function(){ajaxWin.loaded=true;});try{document.fire('ajax_widget_window:loaded');}catch(e){}
$j=jQuery.noConflict();$j(document).ready(function(){$j(this).accordion();});(function($){$.fn.accordion=function(){var accordionHandler={init:function(){$('.toggle-content').hide();$('#single-production-toggle').bind('click',function(){$('#single-production-content').slideToggle();$('#single-production-more, #single-production-less').toggle();$('#single-production-toggle-arrow').toggleClass('ctaGreyArrowDown ctaGreyArrowUp');});$('#cue-sheet-toggle').bind('click',function(){$('#cue-sheet-content').slideToggle();$('#cue-sheet-more, #cue-sheet-less').toggle();$('#cue-sheet-toggle-arrow').toggleClass('ctaGreyArrowDown ctaGreyArrowUp');});$('#license-toggle-standard').bind('click',function(){if($('#license-options').is(':visible')){$('#license-options').slideUp();}else{}});$('#license-toggle-extended').bind('click',function(){if($('#license-options').is(':visible')){}else{$('#license-options').slideDown();}});$('#storyboard-toggle').bind('click',function(){$('#storyboard-container').slideToggle();$('#storyboard-toggle-arrow').toggleClass('ctaGreyArrowDown ctaGreyArrowUp');});$('#lyrics-toggle').bind('click',function(){$('#lyrics-container').slideToggle();$('#lyrics-toggle-arrow').toggleClass('ctaGreyArrowDown ctaGreyArrowUp');});$('#administration-toggle').bind('click',function(){$('#administration-container').slideToggle();$('#administration-toggle-arrow').toggleClass('ctaGreyArrowDown ctaGreyArrowUp');});$($('#keywords-toggle').children().get().reverse()).each(function(){var child=$(this).clone();if(child.prop('tagName')!='SPAN'){$('#keywords-container').prepend(', ').prepend(child);}});$('#keywords-toggle-arrow-container').bind('click',function(event){$('#keywords-container').slideToggle();$('#keywords-toggle-arrow-container').hide();$('#keywords-toggle').hide();event.preventDefault();});}};accordionHandler.init();};})(jQuery);$j=jQuery.noConflict();(function($){$.fn.creditsModal=function(){var creditsModalHandler={init:function(){creditsModalHandler.update();$('#dialog').modal('displayModal');creditsModalHandler.rebindCloseLink();creditsModalHandler.rebindDownloadCashLink();return false;},update:function(){var creditCost=$('#total-credits').html();var cashCost=$('#total-cash').html()+' '+istock.currencyShortName;$('#modal-credit-cost-1').html(creditCost);$('#modal-cash-cost-1').html(cashCost);$('#modal-cash-cost-2').html(cashCost);},rebindCloseLink:function(){$('.modalClose').bind('click',function(){$('#mask, .window').hide();$('body').css('overflow-y','inherit');});},rebindDownloadCashLink:function(){$('#credits-modal-buy-cash-button').bind('click',function(){if(!$('#btn-cash').hasClass('active')){$('#btn-cash').click();}
$('#mask, .window').hide();$('body').css('overflow-y','inherit');});}};creditsModalHandler.init();};})(jQuery);fcu={load_select_widget:function(){$$('.widget_select').each(function(elm){new Autocompleter.SelectBox(elm,{'width':fcuVars.wdth});});},download_init:function(form_id){sffx=form_id.replace(/fcuForm/,'');cctID=$F('ConcreteTypeID'+sffx);fileID=$F('FileID'+sffx);if(cctID!=0)$('dnldSpinner'+sffx).show();switch(true){case(cctID==0):alert(fcuVars.mssg_errNoSize);break;default:var url=istock.url+"/ajax_class_creator.php";var params="ajax_action=GetDialog&ajax_class=filecloseup&FileID="+fileID+"&ConcreteTypeID="+cctID;var myAjax=new Ajax.Request(url,{asynchronous:true,method:"get",parameters:params,onSuccess:fcu.showDialog.bind(this),on301:fcu.xhrError.bind(this),on400:fcu.xhrError.bind(this),on401:fcu.xhrError.bind(this),on403:fcu.xhrError.bind(this),on404:fcu.xhrError.bind(this),on500:fcu.xhrError.bind(this),on503:fcu.xhrError.bind(this),on504:fcu.xhrError.bind(this),onFailure:fcu.xhrError.bind(this)});break;}},showDialog:function(xhrReq){var json=xhrReq.responseText.evalJSON(true);$('dnldSpinner'+sffx).hide();if(typeof(json.goDownload)!='undefined'){lb.download_init("payg");return;}
ajaxWin.show(json);},xhrError:function(xhrReq){var mssg='XHR Error - Code '+xhrReq.status+' ';switch(xhrReq.status){case 301:mssg+='Content Moved';break;case 400:mssg+='Bad Request';break;case 401:mssg+='Unauthorized';break;case 403:mssg+='Forbidden';break;case 404:mssg+='Not Found';break;case 500:mssg+='Internal Server Error';break;case 503:mssg+='Service Unavailable';break;case 504:mssg+='Gateway Timeout';break;case 505:mssg+='HTTP Version Not Supported';break;}
mssg+="\n\nPlease clear your browser's cache,\nreload the page and try your request again."
alert(mssg);},setDefaultCreditType:function(id){if($('DefaultCreditType_PayAsYouGo')&&$F(id)!='payg')$('DefaultCreditType_PayAsYouGo').checked=false;if($('DefaultCreditType_Subscription')&&$F(id)!='subscription')$('DefaultCreditType_Subscription').checked=false;util_updateCreditPlan(0,$F(id));},license_init:function(cllctn){fileID=$F('FileID');collection=(cllctn=='sub')?'Subscription':'PayAsYouGo';var url=istock.url+"/ajax_class_creator.php";var params="ajax_action=GetDialog&ajax_class=filecloseup&Collection="+collection+"&"+$('frm_'+fileID).serialize();var myAjax=new Ajax.Request(url,{asynchronous:true,method:"get",parameters:params,onSuccess:lb.showDialog.bind(this),on301:fcu.xhrError.bind(this),on400:fcu.xhrError.bind(this),on401:fcu.xhrError.bind(this),on403:fcu.xhrError.bind(this),on404:fcu.xhrError.bind(this),on500:fcu.xhrError.bind(this),on503:fcu.xhrError.bind(this),on504:fcu.xhrError.bind(this),onFailure:lb.xhrError.bind(this)});},togglePixelsInches:function(elm){if($(elm).hasClassName('dkgrey'))return;$$('span.dims').invoke('toggleClassName','h');['pixels','inches'].each(function(id){$(id).toggleClassName('dkgrey').toggleClassName('no_txt_dec')});},launchCalc:function(){var url=istock.url+"/ajax_class_creator.php";var params="ajax_action=PixelCalculator&ajax_class=filecloseup";var myAjax=new Ajax.Request(url,{asynchronous:true,method:"get",parameters:params,onSuccess:lb.showDialog.bind(this),on301:fcu.xhrError.bind(this),on400:fcu.xhrError.bind(this),on401:fcu.xhrError.bind(this),on403:fcu.xhrError.bind(this),on404:fcu.xhrError.bind(this),on500:fcu.xhrError.bind(this),on503:fcu.xhrError.bind(this),on504:fcu.xhrError.bind(this),onFailure:lb.xhrError.bind(this)});},clickAgreeBtn:function(collection,isLightbox){$('agreeBtn').replace('<img src="'+istock.cookielessUrl+'/static/images/loading.gif" alt="" />');if(window._gaq){_gaq.push(['_trackPageview','/file_download_approved.php'])}
lb.file_init(collection,isLightbox);}}
try{document.fire("ajax_file_closeup:loaded");}catch(e){}
lb={cash_sales_init:function(fileId,concreteTypeId,licenses){this.fileId=fileId;this.concreteTypeId=concreteTypeId;for(var index in licenses){licenses[index]='el%5B%5D='+licenses[index];}
this.license='el&'+licenses.join('&');lb.download_init();},download_init:function(){var url=istock.url+"/ajax_class_creator.php";var params="ajax_action=GetDialog&ajax_class=filecloseup&Lightbox=0&FileID="+this.fileId+"&ConcreteTypeID="+this.concreteTypeId+"&license="+this.license;var myAjax=new Ajax.Request(url,{asynchronous:true,method:"get",parameters:params,onSuccess:lb.showDialog.bind(this),on301:lb.xhrError.bind(this),on400:lb.xhrError.bind(this),on401:lb.xhrError.bind(this),on403:lb.xhrError.bind(this),on404:lb.xhrError.bind(this),on500:lb.xhrError.bind(this),on503:lb.xhrError.bind(this),on504:lb.xhrError.bind(this),onFailure:lb.xhrError.bind(this)});},showDialog:function(xhrReq){if(xhrReq.status==0){alert('XHR Error Code '+xhrReq.status+' - Please refresh your page and try again.');}else{var json=xhrReq.responseText.evalJSON(true);if($('dnldSpinner_'+this.formID))$('dnldSpinner_'+this.formID).hide();jQuery('#buy-button-loader').hide();if(jQuery('#use-credits-push').is(':visible')){jQuery("#use-credits-push .buy-with-credits-button").show();}else{jQuery('#buy-button-credit').show();}
ajaxWin.show(json);}},license_init:function(cllctn){collection=(cllctn=='sub')?'Subscription':'PayAsYouGo';this.collection=collection;var url=istock.url+"/ajax_class_creator.php";var params="ajax_action=GetDialog&ajax_class=filecloseup&Collection="+collection+"&FileID="+this.fileId+"&ConcreteTypeID="+this.concreteTypeId+"&license="+this.license;var myAjax=new Ajax.Request(url,{asynchronous:true,method:"get",parameters:params,onSuccess:lb.showDialog.bind(this),on301:lb.xhrError.bind(this),on400:lb.xhrError.bind(this),on401:lb.xhrError.bind(this),on403:lb.xhrError.bind(this),on404:lb.xhrError.bind(this),on500:lb.xhrError.bind(this),on503:lb.xhrError.bind(this),on504:lb.xhrError.bind(this),onFailure:lb.xhrError.bind(this)});},file_init:function(collection,isLightbox){var url=istock.url+"/ajax_class_creator.php";var params="ajax_action=DownloadStarted&ajax_class=filecloseup&InitDL=Y&Collection="+collection+"&Lightbox="+isLightbox+"&FileID="+this.fileId+"&ConcreteTypeID="+this.concreteTypeId+"&license="+this.license;var myAjax=new Ajax.Request(url,{asynchronous:true,method:"post",parameters:params,onSuccess:lb.file_init_success.bind(this),on301:lb.xhrError.bind(this),on400:lb.xhrError.bind(this),on401:lb.xhrError.bind(this),on403:lb.xhrError.bind(this),on404:lb.xhrError.bind(this),on500:lb.xhrError.bind(this),on503:lb.xhrError.bind(this),on504:lb.xhrError.bind(this),onFailure:lb.xhrError.bind(this)});},file_init_success:function(xhrReq){var json=xhrReq.responseText.evalJSON(true);ajaxWin.show(json);document.fire('omniture:trackLegacyDownload',json['omniture']);document.fire('tracking:trackDownload',json['tracking']);if(!Prototype.Browser.IE){lb.track_download(json.trackLink);document.body.insert('<iframe src="'+json.link+'" style="display: none;"></iframe>');lb.show_download_links.delay(5);}else{lb.show_download_links();}},show_download_links:function(){$('purchase_download_links').show();$('purchase_download_spinner').hide();},track_download:function(trackLink){try{if(istock.trackdownloads&&trackLink){document.body.insert('<iframe src="'+trackLink+'" style="display: none;"></iframe>');}}catch(e){}},xhrError:function(xhrReq){var mssg='XHR Error - Code '+xhrReq.status+' ';switch(xhrReq.status){case 301:mssg+='Content Moved';break;case 400:mssg+='Bad Request';break;case 401:mssg+='Unauthorized';break;case 403:mssg+='Forbidden';break;case 404:mssg+='Not Found';break;case 500:mssg+='Internal Server Error';break;case 503:mssg+='Service Unavailable';break;case 504:mssg+='Gateway Timeout';break;case 505:mssg+='HTTP Version Not Supported';break;}
mssg+="\n\nPlease clear your browser's cache,\nreload the page and try your request again."
alert(mssg);}}
Event.observe(window, 'load', function() {$$('.fullPage .widget_select').each(function(elm){new Autocompleter.SelectBox(elm,{width:350,callback:'lb.calcSelectPrice'});});});try{document.fire('ajax_lightboxdownload:loaded');}catch(e){}
var $j=jQuery.noConflict();$j(document).ready(function(){$j(this).priceDisplay(istock.displayPriceInCredits);});(function($){$.fn.priceDisplay=function(displayPriceInCredits){var fileHandler={init:function(displayPriceInCredits){fileHandler.displayCredits=displayPriceInCredits;fileHandler.setupBindings();if(window.sessionStorage){fileHandler.updateFromSessionStorage();}
fileHandler._updateTotal();fileHandler._updatePixel();fileHandler._displayViewCartLink();$('#buy-section-loader').hide();$('#total-buy-section').show();},setupBindings:function(){$('#showPixel, #showNonPixel').bind('click',function(){$('#showPixel, #showNonPixel').toggleClass('active');fileHandler._updatePixel();});$('#show-credits, #show-cash').bind('click',function(event){event.preventDefault();if($('#show-credits').length>0&&$('#show-cash').length>0){$('#show-cash, #show-credits').toggleClass('h');fileHandler.displayCredits=!fileHandler.displayCredits;fileHandler._updateTotal();fileHandler._displayViewCartLink();fileHandler._handleHideCashCases($('#sale-note'));}});$('#filesGrid tr td').click(fileHandler.selectFileSize);$('#licensesGrid tr td, input[name=licenses]').click(function(){var checkbox=$(this).parent().find(':checkbox');if(checkbox.attr('disabled')!=='disabled'){checkbox.prop('checked',!checkbox.attr('checked'));}
fileHandler._updateTotal();});$('#license-toggle-standard').click(function(){$('input:checkbox[name=licenses]:checked:not(:disabled)').each(function(){$(this).attr('checked',false);});fileHandler._updateTotal();});$('#HD, #PAL, #NTSC').click(function(){var oldStandard=$('#standard .active').html();var newStandard=$(this).attr('id');var format=$('#format .active').html();var availableSizes='.'+newStandard+format;var oldRadioButton=oldStandard+format;var newRadioButton=newStandard+format;var toggleSelector='#standard';fileHandler.videoToggle(availableSizes,oldRadioButton,newRadioButton,toggleSelector,this);fileHandler._updateTotal();});$('#MOV,#MP4,#WMV').click(function(){var standard=$('#standard .active').html();var oldFormat=$('#format .active').html();var newFormat=$(this).attr('id');var availableSizes='.'+standard+newFormat;var oldRadioButton=standard+oldFormat;var newRadioButton=standard+newFormat;var toggleSelector='#format';fileHandler.videoToggle(availableSizes,oldRadioButton,newRadioButton,toggleSelector,this);fileHandler._updateTotal();});$('#buy-button-credit, .buy-with-credits-button').click(function(){if(!($(this).attr('href'))){var licenses=[],fileId=$('#fileId').val(),concreteTypeId=$('input:radio[name=size]:checked').val();if($(this).hasClass('pump-audio')){var id=$('input:radio[name=size]:checked').attr('id');licenses.push(id.replace('concreteTypeId'+concreteTypeId+'_el',''));}else{var elId;$('#licensesGrid input:checked').each(function(){elId=this.id;licenses.push(elId.replace('el',''));});}
$(this).hide();$('#buy-button-loader').insertAfter($(this)).show();var totalCredits=$('#total-credits').html();if((totalCredits>0&&(!istock.user||istock.user.creditsRemaining<totalCredits))&&!$('body').hasClass('admin-download')){$(this).creditsModal();$('#buy-button-loader').hide();$(this).show();}else{lb.cash_sales_init(fileId,concreteTypeId,licenses);}}});$('#buy-button-cash').click(function(){var fileId=$('#fileId').val(),fileSize=$('input:radio[name=size]:checked'),concreteTypeId=fileSize.val(),id,licenses,cookiePriceLevel=istock.cookie.getCookie('omniturePriceLevel'),priceTier="none",filePriceTier;if($(this).hasClass('pump-audio')){id=fileSize.attr('id');licenses=id.replace('concreteTypeId'+concreteTypeId+'_el','');}else{licenses=[];$('#licensesGrid input:checked').each(function(){licenses.push(this.id.replace('el',''));});}
priceTier=fileHandler.findPriceTier(fileId);$(this).hide();$('#buy-button-loader').insertAfter($(this)).show();fileHandler.upsertFileToCart(fileId,concreteTypeId,licenses,priceTier);$('#view-cash-cart').removeClass('hidden-element');});},selectFileSize:function(){$(this).parent().find('input[type=radio]').prop('checked',true);var selectedConcreteId=$(this).parent().find('input[type=radio]').val();$('.bgBlue').removeClass('bgBlue');$(this).parent().addClass('bgBlue');fileHandler.updateExtendedLicensePrices(selectedConcreteId);fileHandler._updateTotal();},updateExtendedLicensePrices:function(concreteTypeId){var licensePricing=FilePriceInformation[concreteTypeId].availableLicenses;$('#licensesGrid > tbody > tr').each(function(i){var currentLicenseId=$(this).find('input').attr('id').replace('el','');if(parseInt(licensePricing[currentLicenseId].priceInCredits,10)===0){$(this).find('input').prop('disabled',true);$(this).find('input').attr('checked',true);}else{$(this).find('input').prop('disabled',false);}
if(!licensePricing[currentLicenseId].isMandatory){$(this).find('.credits > span.amount').text(licensePricing[currentLicenseId].priceInCredits);$(this).find('.cash > span.amount').text(licensePricing[currentLicenseId].priceConverted);}});},upsertFileToCart:function(fileId,concreteTypeId,licenses,priceTier){if(licenses.length===0){licenses=["0"];}
var ajaxUrl='/cart-ajax/upsert-file/fileId/'+fileId+'/concreteTypeId/'+concreteTypeId+'/licenses/'+licenses+'/asNewest/1'+'/priceTier/'+priceTier;$j.ajax(ajaxUrl).done(function(response){var status=response.status;var settings={content:response.viewscript};if(status==='insert'||status==='update'){settings.title='<h3>'+response.title+'</h3>',$('#filesCount').text(response.filesCount);$('#buy-button-text-default').hide();$('#buy-button-text-update').show();$('#toolbar-cart').addClass('active');}else if(response.status==='failure'){settings.title='<h3 class="err">'+response.title+'</h3>',$('#toolbar-cart span').addClass('err');$('#toolbar-cart').removeClass('active');}
$('#toolbar-cart span').addClass('files-count-bold');$('#cart-toaster').toaster(settings);$('#buy-button-cash').show();$('#buy-button-loader').hide();fileHandler._displayViewCartLink();if(response.status!='failure'){document.fire('toaster:FileAddedToCart');document.fire('omniture:FileCloseupAddToCart',{'concreteTypeId':concreteTypeId,'licenses':licenses,'priceTier':priceTier});}});},videoToggle:function(availableSizes,oldRadioButton,newRadioButton,toggleSelector,toggleEvent){$('#filesGrid tr').hide();$('#filesGrid tr').first().show();$(availableSizes).show();if(toggleSelector=='#standard'){var target=$('.'+$(toggleEvent).attr('id'));if(target.length!==0&&target.is(':hidden')){$('#file-preview > .video').hide();target.show();}}
videoDefaults[oldRadioButton]=parseInt($('input[type=radio]:checked').val(),10);if(videoDefaults[newRadioButton]===0){var lastRadioButtonValue=$('.'+newRadioButton+':last input[type=radio]').val();videoDefaults[newRadioButton]=lastRadioButtonValue;}
var selector='#concreteTypeId'+videoDefaults[newRadioButton];$(selector).attr('checked',true).parent().parent().addClass('bgBlue');$(toggleSelector+' .active').removeClass('active');$(toggleEvent).addClass('active');},getFormattedCurrency:function(cost){var shortname=istock.currencyShortName;var symbol=istock.currencySymbol;if(shortname=='JPY'){cost=accounting.formatMoney(cost,symbol,0);}else if(shortname=='EUR'){cost=accounting.formatMoney(cost,symbol,2,".",",");}else{cost=accounting.formatMoney(cost,symbol);}
return cost;},findPriceTier:function(fileId){var cookiePriceLevel=istock.cookie.getCookie('omniturePriceLevel');var priceTier="none";if(cookiePriceLevel!==null){var filePriceTier=cookiePriceLevel.split("|");if(fileId==filePriceTier[0]){priceTier=filePriceTier[1];}}
return priceTier;},updateFromSessionStorage:function(){var fileId=$("#fileId").val();var sessionKey='miniAdp-'+fileId;var data=sessionStorage.getItem(sessionKey);var size;var licenses;if(data){data=JSON.parse(data);size=data.size;licenses=data.licenses;fileHandler.displayCredits=!data.fromCashPath;fileHandler._toggleCashCreditDisplay();$(licenses).each(function(i,licenseId){$('#el'+licenseId).attr('checked','checked');});}},_displayViewCartLink:function(){if(parseInt($('#filesCount').html(),10)>0&&!fileHandler.displayCredits){$('#view-cart-link').show();}else{$('#view-cart-link').hide();}},_updatePixel:function(){if($('#showPixel').hasClass('active')){$('.nonPixel').hide();$('.pixel').show();}else{$('.pixel').hide();$('.nonPixel').show();}},_toggleCashCreditDisplay:function(){var cashElements=$('.cash, #cash-container, #use-credits-push');var creditElements=$('.credits, #buy-button-credit, #total-credits, #credits-label, #total-container');if(fileHandler.displayCredits){cashElements.hide();creditElements.show();}else{creditElements.hide();cashElements.show();}},_updateTotal:function(){this._toggleCashCreditDisplay();var concreteTypeCostCredits=0,concreteTypeCostCash=0,licenseCostCredits=0,licenseCostCash=0,currencyShortName=istock.currencyShortName,totalCostCredits,totalCostCash,formattedTotalCostCash;cashElements=$('.cash, #cash-container, #use-credits-push'),creditElements=$('.credits, #buy-button-container, #buy-button-credit, #total-credits, #credits-label, #total-container');if($('#total-credits').length>0&&$('#total-cash').length>0){try{concreteTypeCostCredits=parseFloat($('input:radio[name=size]:checked').closest('tr').find('div.credits > span.amount').html());concreteTypeCostCash=$('input:radio[name=size]:checked').closest('tr').find('div.cash > span.amount').html();if(currencyShortName==='EUR'){concreteTypeCostCash=concreteTypeCostCash.replace('.','');concreteTypeCostCash=parseFloat(concreteTypeCostCash.replace(',','.'));}else{concreteTypeCostCash=parseFloat(concreteTypeCostCash.replace(',',''));}
if(isNaN(concreteTypeCostCredits)){concreteTypeCostCredits=0;}
if(isNaN(concreteTypeCostCash)){concreteTypeCostCash=0;}
$('input:checkbox[name=licenses]:checked').each(function(){var thisLicenseCostCredits=parseFloat($(this).closest('tr').find('div.credits > span.amount').html()),thisLicenseCostCash=$(this).closest('tr').find('div.cash > span.amount').html();if(currencyShortName==='EUR'){thisLicenseCostCash=thisLicenseCostCash.replace('.','');thisLicenseCostCash=parseFloat(thisLicenseCostCash.replace(',','.'));}else{thisLicenseCostCash=parseFloat(thisLicenseCostCash.replace(',',''));}
if(isNaN(thisLicenseCostCash)){thisLicenseCostCash=0;}
if(isNaN(thisLicenseCostCredits)){thisLicenseCostCredits=0;}
licenseCostCredits=licenseCostCredits+thisLicenseCostCredits;licenseCostCash=licenseCostCash+thisLicenseCostCash;});}catch(err){}
totalCostCredits=concreteTypeCostCredits+licenseCostCredits;totalCostCash=parseFloat(concreteTypeCostCash)+parseFloat(licenseCostCash);if(isNaN(totalCostCredits)){totalCostCredits=0;}
if(isNaN(totalCostCash)){totalCostCash=0;}
formattedTotalCostCash=fileHandler.getFormattedCurrency(totalCostCash);$('#total-credits, #push-total-credits').html(totalCostCredits);$('#total-cash, #push-total-cash').html(formattedTotalCostCash);creditTitle=$('input:radio[name=size]:checked').closest('tr').find('div.credits').contents().eq(2).text();$('#credits-label').html(creditTitle);if(totalCostCredits==1){$('#plural').hide();$('#singular').show();$('#modal-plural').hide();$('#modal-singular').show();}else{$('#plural').show();$('#singular').hide();$('#modal-plural').show();$('#modal-singular').hide();}
fileHandler._calculateCreditUpsellValues({creditCost:totalCostCredits,cashCost:totalCostCash});fileHandler._updatePushToCreditsBox();fileHandler._saveFileOptions(totalCostCredits,formattedTotalCostCash);if(totalCostCash<0){$('#cash-container').hide();}else if(totalCostCash==0&&!fileHandler.displayCredits){$('#cash-container').hide();$('#total-container').hide();$('#buy-button-credit').show();$('#cash-zero-total-container').show();}else{$('#cash-zero-total-container').hide();if(fileHandler.displayCredits){$('#total-container').show();$('#buy-button-cash').hide();$('#buy-button-credit').show();if(totalCostCash==0){$('#save-with-credits').hide();}else{$('#save-with-credits').show();}}else{$('#total-container').hide();$('#buy-button-cash').show();$('#buy-button-credit').hide();}}
this._updateCreditPushLink();}else{}
fileHandler._updateCookie();},_updateCreditPushLink:function(){var buyCreditsLink=$('#buy-credits-link'),downloadWithCredits=$('#download-with-credits'),buyWithCredits='buy-with-credits-button';if(!istock.user){return;}
if(istock.user.creditsRemaining>=parseFloat($('#total-credits').html())){buyCreditsLink.removeClass(buyWithCredits).hide();downloadWithCredits.addClass(buyWithCredits).show();}else{buyCreditsLink.addClass(buyWithCredits).show();downloadWithCredits.removeClass(buyWithCredits).hide();}},_updateCookie:function(){var totalInfo={'fileId':$('#fileId').val(),'creditsCost':$('#total-credits').html(),'cashCost':$('#total-cash').html(),'currencyShortName':istock.currencyShortName},value=JSON.stringify(totalInfo),name="fcup_welcomePage_totalInfo",days=1,date,expires="";if(days){date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString();}
document.cookie=name+"="+value+expires+"; path=/; domain=.istockphoto.com";},_calculateCreditUpsellValues:function(options){var points=fileHandler._minimumPackageForCredits(120);var price=istock.creditPackages[points];istock.fcup.pricePerCredit=price/points;var priceUsingCredits=options.creditCost*istock.fcup.pricePerCredit;var percentSave=(options.cashCost-priceUsingCredits)/options.cashCost*100;istock.fcup.formattedNewCost=fileHandler.getFormattedCurrency(priceUsingCredits);istock.fcup.formattedPercentSave=accounting.formatNumber(percentSave,0);},_updatePushToCreditsBox:function(options){$("#push-total-new").html(istock.fcup.formattedNewCost);$("#percent-save-credits").html(istock.fcup.formattedPercentSave);$("#push-total-new-singular").html(istock.fcup.formattedNewCost);},_minimumPackageForCredits:function(credits){var minimumPoints,creditPackages=istock.creditPackages;for(var points in creditPackages){minimumPoints=points;if(credits<=points){break;}}
return minimumPoints;},_saveFileOptions:function(totalCostCredit,formattedTotalCostCash){var licenses=[],fileId=$('#fileId').val(),concreteTypeId=$('input:radio[name=size]:checked').val();var id;var elId;if($(this).hasClass('pump-audio')){id=$('input:radio[name=size]:checked').attr('id');licenses.push(id.replace('concreteTypeId'+concreteTypeId+'_el',''));}else{elId;$('#licensesGrid input:checked').each(function(){elId=this.id;licenses.push(elId.replace('el',''));});}
var priceTier=this.findPriceTier(fileId);var adpData={totalCash:formattedTotalCostCash,savePercent:istock.fcup.formattedPercentSave,totalCredits:totalCostCredit,totalCreditsCost:istock.fcup.formattedNewCost,currencyShortName:istock.currencyShortName,priceTier:priceTier,licenses:licenses,size:concreteTypeId,searchToken:istock.searchToken,fromCashPath:!fileHandler.displayCredits,},trackingData={priceTier:priceTier,licenses:licenses};sessionStorage.setItem('miniAdp-'+fileId,JSON.stringify(adpData));sessionStorage.setItem('miniAdpTracking-'+fileId,JSON.stringify(trackingData));}},videoDefaults={'HDMOV':0,'HDMP4':0,'HDWMV':0,'PALMOV':0,'PALMP4':0,'PALWMV':0,'NTSCMOV':0,'NTSCMP4':0,'NTSCWMV':0};if(typeof displayPriceInCredits==='undefined'){displayPriceInCredits=true;}
fileHandler.init(displayPriceInCredits);};})(jQuery);var PremiereAdmin={premiereSubmitRequest:function(params){$('adminPremiereConfirmButton').stopObserving('click');var url='/ajax_class_creator.php'
var ajaxRequest=new Ajax.Request(url,{method:'post',parameters:params,onComplete:this.premiereActionComplete.bind(this),onFailure:this.premiereActionFailed.bind(this)});},premiereActionComplete:function(req){var premiereResponse=req.responseText
if(premiereResponse=='ajax_fail'){ajaxWin.cancelWindow();alert('An error was encountered while trying to process your request');}
var premiereData=req.responseText.evalJSON(true);if(premiereData.resultStatus==1){$('ajaxWinBody').replace('<p>'+premiereData.resultMessage+'</p>');if($('agencyActions')){$('agencyActions').replace('<p>File can\'t be moved to the Agency Collection.</p>');}
if(premiereData.showlist){premiereData.showlist.each(function(elm){if($(elm)){$(elm).show();}});}
if(premiereData.hidelist){premiereData.hidelist.each(function(elm){if($(elm)){$(elm).hide();}});}
if(premiereData.instantlyClose){ajaxWin.cancelWindow();}else{var contButton='<a class="btn_orange" onclick="ajaxWin.cancelWindow(); return false;" href="#">Continue</a>'+'<div class = "clear"></div>';ajaxWin.show({title:premiereData.resultTitle,cntnt:"<p style=\"padding:0 10px\">"+premiereData.resultMessage+"</p>",wdth:400,footer:contButton});}}else if(premiereData.resultStatus==0){ajaxWin.show({title:premiereData.resultTitle,cntnt:'<p class = "error" style=\"padding:0 10px\">Failed to complete request!!<br/>'+premiereData.resultMessage+'</p>',wdth:400,footer:'<a class="btn_orange" onclick="ajaxWin.cancelWindow(); return false;" href="#">Continue</a>'+'<div class = "clear"></div>'});}else{alert('Unknown response received when submitting request!!');}},premiereActionFailed:function(req){alert('There was a problem trying to process your request. Try again.');},confirmReInstate:function(userID){ajaxWin.show({title:'Confirm Contributor file ReInstatement',cntnt:"<p style=\"padding:0 10px\">Are you sure you want to mark all the user's cancelled Vetta files as Approved? Only the files that were "+"previously Approved will be Re-Instated. Files that were not yet approved will remain cancelled.</p>",wdth:400,footer:'<a class="btn_orange fl" onclick="ajaxWin.cancelWindow(); return false;" href="#">No</a>'+'<a id = "adminPremiereConfirmButton" class="btn_orange fr" href="" onclick = "return false;">Yes</a>'+'<div class = "clear"></div>'});$('adminPremiereConfirmButton').observe('click',function(event){PremiereAdmin.submitReInstate(userID);});},submitReInstate:function(userID){var params='ajax_action=reInstatePremiereNomination&ajax_class=editorqueue'+'&userID='+userID;this.premiereSubmitRequest(params);},confirmPremiereNomination:function(fileID){var priceOptionsForm=$('priceOptionsRadio_'+fileID);if(priceOptionsForm!=null){var priceOption=priceOptionsForm.getInputs('radio').find(function(radio){return radio.checked;}).value;}
ajaxWin.show({title:'Add to Vetta Collection?',cntnt:'<p style=\"padding:0 10px\">Are you sure you want to move this file to the Vetta Collection?</p>',wdth:400,footer:'<a class="btn_orange fl" onclick="ajaxWin.cancelWindow(); return false;" href="#">No</a>'+'<a id = "adminPremiereConfirmButton" class="btn_orange fr" href="" onclick = "return false;" >Yes</a>'+'<div class = "clear"></div>'});$('adminPremiereConfirmButton').observe('click',function(event){PremiereAdmin.submitPremiereNomination(fileID,priceOption);});},submitPremiereNomination:function(fileID,priceOption){var params='ajax_class=editorqueue&ajax_action=nominateFile'+'&fileID='+fileID;if(priceOption){params+='&priceOption='+priceOption;}
this.premiereSubmitRequest(params);},confirmCancelFileNomination:function(fileID){ajaxWin.show({title:'Confirm nomination cancellation',cntnt:'<p style=\"padding:0 10px\">Are you sure you want to remove this file from the Vetta Collection?</p>',wdth:400,footer:'<a class="btn_orange fl" onclick="ajaxWin.cancelWindow(); return false;" href="#">No</a>'+'<a id = "adminPremiereConfirmButton" class="btn_orange fr" href="" onclick = "return false;">Yes</a>'+'<div class = "clear"></div>'});$('adminPremiereConfirmButton').observe('click',function(event){PremiereAdmin.submitPremiereFileCancel(fileID);});},submitPremiereFileCancel:function(fileID){var params='ajax_class=editorqueue&ajax_action=cancelFileNomination'+'&fileID='+fileID;this.premiereSubmitRequest(params);},confirmPremiereMove:function(fileID){var priceOptionsForm=$('priceOptionsRadio_'+fileID);if(priceOptionsForm!=null){var priceOption=priceOptionsForm.getInputs('radio').find(function(radio){return radio.checked;}).value;}
ajaxWin.show({title:'Add to Vetta Collection?',cntnt:'<p style=\"padding:0 10px\">Are you sure you want to move this file to the Vetta Collection?</p>',wdth:400,footer:'<a class="btn_orange fl" onclick="ajaxWin.cancelWindow(); return false;" href="#">No</a>'+'<a id = "adminPremiereConfirmButton" class="btn_orange fr" href="" onclick = "return false;" >Yes</a>'+'<div class = "clear"></div>'});$('adminPremiereConfirmButton').observe('click',function(event){PremiereAdmin.submitPremiereMove(fileID,priceOption);});},submitPremiereMove:function(fileID,priceOption){var params='ajax_class=editorqueue&ajax_action=approveFileNomination'+'&fileID='+fileID;if(priceOption){params+='&priceOption='+priceOption;}
this.premiereSubmitRequest(params);},}
document.observe('dom:loaded',function(){zoomFile.zoomControlInit();});var trackZoom;var zoomFile={ZOOMIN:'zoomin',ZOOMOUT:'zoomout',IMAGE_ZOOM_PAGE:'/image-zoom/',IMAGE_EXT:'.jpg',resized:false,stepSkipping:0,move:'',fileID:0,zoomFactor:0,maxSize:0,panoramicPercentage:0,viewport:{width:0,height:0},size:0,currentPos:{X:0,Y:0},clickPos:{X:0,Y:0},thumbImg:{width:0,height:0},currentImg:{width:0,height:0},offset:{width:0,height:0},zoomControl:null,zoomDraggable:null,zoomDraggableObserver:null,navigatorDraggable:null,constraintArea:{ZoomDraggableDiv:{minX:0,minY:0,maxX:0,maxY:0},NavCtrlBox:{minX:0,minY:0,maxX:-1,maxY:-1}},navigatorData:{img:{width:0,height:0},box:{width:10,height:10,border:2},ratio:{width:0,height:0}},isDragging:false,loadingQueue:[],initializeZoomTracking:function(){if(trackZoom==undefined){trackZoom=true;}},trackInteraction:function(){if(trackZoom){document.fire('omniture:imageZoom');trackZoom=false;}},zoomControlInit:function(){if(!$('ZoomImageDiv')){return;}
this.move=this.ZOOMIN;this.fileID=$F('ZoomFileID');this.zoomFactor=parseFloat($F('ZoomFactor'));this.maxSize=parseInt($F('ZoomMaxSize'));this.panoramicPercentage=parseFloat($F('PanoramicPercent'));var viewportSize=parseInt($F('ViewPortSize'));this.viewport.width=viewportSize;this.viewport.height=viewportSize;this.offset.width=Math.round(this.viewport.width/2);this.offset.height=Math.round(this.viewport.height/2);this.currentPos.X=this.offset.width;this.currentPos.Y=this.offset.height;var zoomImg=$('ZoomImage');this.thumbImg.width=zoomImg.width;this.thumbImg.height=zoomImg.height;this.currentImg.width=this.thumbImg.width;this.currentImg.height=this.thumbImg.height;['zoom-hover-div','ZoomDraggableDiv','zoom-navigator','nav-image-clear','NavCtrlBox','nav-ctrl-handle','nav-image'].each(function(eleID){this.disableHighlight($(eleID));}.bind(this));var navImg=$("nav-image-clear");this.navigatorData.img.width=parseInt(navImg.getStyle("width"));this.navigatorData.img.height=parseInt(navImg.getStyle("height"));zoomImg.observe('mouseover',function(){this.showZoomHover();}.bind(this));zoomImg.observe('mouseout',function(){this.hideZoomHover();}.bind(this));zoomImg.observe('click',function(e){this.initializeZoomTracking();this.doClick(e)}.bind(this));var hoverDiv=$("zoom-hover-div");hoverDiv.observe("mouseover",function(){this.showZoomHover();}.bind(this));hoverDiv.observe("click",function(e){$("zoom-hover-div").stopObserving("mouseover");this.initializeZoomTracking();this.hideZoomHover();this.doClick(e);}.bind(this));var draggableDiv=$('ZoomDraggableDiv');draggableDiv.oncontextmenu=function(e){this.mSetMove(this.ZOOMOUT);this.doClick(e);return false;}.bind(this);draggableDiv.observe('click',function(e){this.trackInteraction();if(this.isDragging){Event.stop(e);}else{if(this.zoomControl.value+1<=this.maxSize){this.mSetMove(this.ZOOMIN);this.doClick(e);}}}.bind(this));this.zoomDraggable=new Draggable('ZoomDraggableDiv',{constraintarea:true});$("nav-image-clear").observe("click",this.navigationMoveTo.bind(this));var zoomIn=$('zoom-in-img');zoomIn.observe('click',function(){this.zoomControl.setValue(parseInt(this.zoomControl.value)+1)}.bind(this));zoomIn.observe('mouseover',function(){$('zoom-in-img').src=istock.cookielessUrl+'/static/images/zoom/in-hover.png';});zoomIn.observe('mouseout',function(){$('zoom-in-img').src=istock.cookielessUrl+'/static/images/zoom/in.png';});var zoomOut=$('zoom-out-img');zoomOut.observe('click',function(){this.zoomControl.setValue(parseInt(this.zoomControl.value)-1)}.bind(this));zoomOut.observe('mouseover',function(){$('zoom-out-img').src=istock.cookielessUrl+'/static/images/zoom/out-hover.png';});zoomOut.observe('mouseout',function(){$('zoom-out-img').src=istock.cookielessUrl+'/static/images/zoom/out.png';});var handle=$("zoom-handle-img");handle.observe("mouseover",function(){$("zoom-handle-img").src=istock.cookielessUrl+"/static/images/zoom/handle-hover.png";});handle.observe("mouseout",function(){$("zoom-handle-img").src=istock.cookielessUrl+"/static/images/zoom/handle.png";});var zoomSliderSteps=[];for(var i=0;i<=this.maxSize;i++){zoomSliderSteps[i]=i;}
this.zoomControl=new Control.Slider("zoom-handle-div","zoom-track-div",{range:$R(this.maxSize,0),axis:'vertical',values:zoomSliderSteps,sliderValue:0,onChange:function(value){if(value==this.size){}else{if(value<this.size){this.move=this.ZOOMOUT;}else{this.move=this.ZOOMIN;this.trackInteraction();}
this.clickPos.X=parseFloat($('ZoomDroppableDiv').style.width)/2;this.clickPos.Y=parseFloat($('ZoomDroppableDiv').style.height)/2;this.submitMove(value);}}.bind(this)});this.navigatorDraggable=new Draggable("NavCtrlBox",{handle:"nav-ctrl-handle",constraintarea:true});this.zoomDraggableObserver={onDrag:function(eventName,draggable,event){if($('h'+this.size)){$('h'+this.size).show();}
if(draggable.element.id==this.zoomDraggable.element.id){this._viewPortDraggable();}
else if(draggable.element.id==this.navigatorDraggable.element.id){this._navBoxDraggable();}}.bind(this),onEnd:function(eventName,draggable,event){this.trackInteraction();if($('h'+this.size)){$('h'+this.size).hide();}
if(draggable.element.id==this.zoomDraggable.element.id){this.isDragging=true;var returnVal=this._viewPortDraggable();this.currentPos.X=(returnVal[0]+this.offset.width);this.currentPos.Y=(returnVal[1]+this.offset.height);window.setTimeout(function(){this.isDragging=false;}.bind(this),500);}
else if(draggable.element.id==this.navigatorDraggable.element.id){var returnVal=this._navBoxDraggable();this.currentPos.X=(returnVal[0]+this.offset.width);this.currentPos.Y=(returnVal[1]+this.offset.height);}}.bind(this)}
Draggables.addObserver(this.zoomDraggableObserver);$('ActualImageDiv').removeClassName('h');},_viewPortDraggable:function(){var zoomDrag=$('ZoomDraggableDiv');var left=-(parseInt(zoomDrag.getStyle('left')));var top=-(parseInt(zoomDrag.getStyle('top')));var navLeft=Math.round(left*this.navigatorData.ratio.width);var navTop=Math.round(top*this.navigatorData.ratio.height);$('NavCtrlBox').setStyle({left:(navLeft+1)+'px',top:(navTop+1)+'px'});$('nav-image').setStyle({left:-(navLeft-this.navigatorData.box.border)-4+'px',top:-(navTop-this.navigatorData.box.border)-3+'px'});return[left,top];},_navBoxDraggable:function(){var navBox=$('NavCtrlBox');var left=parseInt(navBox.getStyle('left'));var top=parseInt(navBox.getStyle('top'));$('nav-image').setStyle({left:-(left-this.navigatorData.box.border)-3+'px',top:-(top-this.navigatorData.box.border)-4+'px'});var zoomDrag=$('ZoomDraggableDiv');var zoomDragLeft=Math.round(left/this.navigatorData.ratio.width);var zoomDragTop=Math.round(top/this.navigatorData.ratio.height);zoomDrag.setStyle({left:-(Math.min(zoomDragLeft,this.constraintArea.ZoomDraggableDiv.maxX))+'px',top:-(Math.min(zoomDragTop,this.constraintArea.ZoomDraggableDiv.maxY))+'px'});return[zoomDragLeft,zoomDragTop];},navigationMoveTo:function(e){$("nav-image-clear").stopObserving("click");this.trackInteraction();if(this.size!=0){var navPos=$("zoom-navigator").cumulativeOffset();var newClickX=Event.pointerX(e);var newClickY=Event.pointerY(e);var navBox=$('NavCtrlBox');var navBoxX=parseInt(navBox.getStyle('left'));var navBoxY=parseInt(navBox.getStyle('top'));var x=newClickX-navPos.left-navBoxX-this.navigatorData.box.width/2;var y=newClickY-navPos.top-navBoxY-this.navigatorData.box.height/2;if(navBoxX+x>=this.constraintArea.NavCtrlBox.minX){x=this.constraintArea.NavCtrlBox.minX-navBoxX;}
if(navBoxY+y>=this.constraintArea.NavCtrlBox.minY){y=this.constraintArea.NavCtrlBox.minY-navBoxY;}
if(navBoxX+x<=0){x=-(navBoxX+1);}
if(navBoxY+y<=0){y=-(navBoxY+1);}
new Effect.MoveBy(navBox,y,x,{duration:1.0});new Effect.Move($('nav-image'),{x:(-(navBoxX+x)-this.navigatorData.box.border),y:(-(navBoxY+y)-this.navigatorData.box.border),mode:'absolute',duration:1.0});var zoomDiv=$('ZoomDraggableDiv');var zoomX=parseInt(zoomDiv.getStyle('left'));var zoomY=parseInt(zoomDiv.getStyle('top'));var moveX=-x/this.navigatorData.ratio.width;var moveY=-y/this.navigatorData.ratio.height;if(-(zoomX+moveX)>=this.constraintArea.ZoomDraggableDiv.maxX){moveX=-(this.constraintArea.ZoomDraggableDiv.maxX+zoomX);}
if(-(zoomY+moveY)>=this.constraintArea.ZoomDraggableDiv.maxY){moveY=-(this.constraintArea.ZoomDraggableDiv.maxY+zoomY);}
if(-(zoomX+moveX)<=0){moveX=-(zoomX);}
if(-(zoomY+moveY)<=0){moveY=-(zoomY);}
new Effect.MoveBy(zoomDiv,moveY,moveX,{duration:1.0,afterFinish:function(){$("nav-image-clear").observe("click",this.navigationMoveTo.bind(this));}.bind(this)});var left=-(zoomX+moveX);var top=-(zoomY+moveY);this.currentPos.X=left+this.offset.width;this.currentPos.Y=top+this.offset.height;}},doClick:function(e){if(this.isDragging||this.move==''){Event.stop(e);}else{this.getXYOffset(e);var newSize;if(this.move==this.ZOOMIN){newSize=this.size+1;}
else if(this.move==this.ZOOMOUT){newSize=this.size-1;}
this.submitMove(newSize);}},getXYOffset:function(e){if(this.size==0){var div=$('ZoomImage');}else{var div=$('ZoomDroppableDiv');}
var imgY=div.offsetTop;var imgX=div.offsetLeft;parentObj=div.offsetParent;do{imgY+=parentObj.offsetTop;imgX+=parentObj.offsetLeft;parentObj=parentObj.offsetParent;}while(parentObj);var pageX=pageY=0;if(typeof e!='undefined'&&e.pageX!=undefined){pageX=e.pageX;pageY=e.pageY;}else if(typeof window.event!='undefined'&&event.clientX!=undefined){pageX=event.clientX;pageY=event.clientY;}
this.clickPos.X=(pageX-imgX);this.clickPos.Y=(pageY-imgY);},submitMove:function(value){$("zoom-hover-div").addClassName('h');this.size=value;if($('s'+this.size)){this.requestImg=false;}
else{this.requestImg=true;}
this.zoomInOut();},zoomInOut:function(){$("zoom-loading-img").addClassName('h');this.mSetCurrentValues();this.mSetMove(this.move);this.zoomControl.setValue(this.size);var draggable=$('ZoomDraggableDiv');var droppable=$('ZoomDroppableDiv');if(this.size==0){$('zoom-hover-div').observe('mouseover',function(){this.showZoomHover();}.bind(this));$('ZoomImageDiv').setStyle({height:''});$('ActualImageDiv').removeClassName('h');$('zoom-control-div').addClassName('h');droppable.hide();}else{this.constraintArea.ZoomDraggableDiv.maxX=this.currentImg.width-this.viewport.width;this.constraintArea.ZoomDraggableDiv.maxY=this.currentImg.height-this.viewport.height;this.mBuildImage(this.mGetImageURL(),this.currentImg.width,this.currentImg.height);$('ActualImageDiv').addClassName('h');$('zoom-control-div').removeClassName('h');var divLeft=-(this.currentPos.X-this.offset.width);var divTop=-(this.currentPos.Y-this.offset.height);draggable.setStyle({width:this.currentImg.width+'px',left:divLeft+'px',top:divTop+'px'});droppable.setStyle({display:'block',width:(Math.min(this.currentImg.width,this.viewport.width))+'px',height:(Math.min(this.currentImg.height,this.viewport.height))+'px'});$('ZoomImageDiv').setStyle({height:this.viewport.height+'px'});this.setNavigatorData(this.currentImg.width,this.currentImg.height);this.updateNavigatorLocation();}},mSetCurrentValues:function(){if(this.size==0){this.currentPos.X=this.offset.width;this.currentPos.Y=this.offset.height;this.currentImg.width=this.thumbImg.width;this.currentImg.height=this.thumbImg.height;}
else{var targetWidth=this.mGetZoomedValue(this.thumbImg.width);var targetHeight=this.mGetZoomedValue(this.thumbImg.height);if(!this.resized){var newDimensions=this.mResizeForPanoramic(targetWidth,targetHeight);targetWidth=newDimensions[0];targetHeight=newDimensions[1];}
this.clickPos.X=this.currentPos.X-this.offset.width+this.clickPos.X;this.clickPos.Y=this.currentPos.Y-this.offset.height+this.clickPos.Y;var percentageX=this.clickPos.X/this.currentImg.width;var percentageY=this.clickPos.Y/this.currentImg.height;var targetPosX=Math.round(targetWidth*percentageX);var targetPosY=Math.round(targetHeight*percentageY);targetPosX=Math.max(targetPosX,this.offset.width);targetPosY=Math.max(targetPosY,this.offset.height);this.currentPos.X=Math.min(targetPosX,targetWidth-this.offset.width);this.currentPos.Y=Math.min(targetPosY,targetHeight-this.offset.height);this.currentImg.width=targetWidth;this.currentImg.height=targetHeight;}},mResizeForPanoramic:function(width,height){if(width<this.viewport.width){this.resized=true;this.viewport.width=this.viewport.width*this.panoramicPercentage;this.offset.width=this.offset.width*this.panoramicPercentage;var zoomLoadingImg=$('zoom-loading-img');zoomLoadingImg.setStyle({left:'70px'});}
if(height<this.viewport.height){this.resized=true;this.viewport.height=this.viewport.height*this.panoramicPercentage;this.offset.height=this.offset.height*this.panoramicPercentage;var zoomLoadingImg=$('zoom-loading-img');zoomLoadingImg.setStyle({top:'124px'});}
while(this.resized&&(width<this.viewport.width||height<this.viewport.height)){this.stepSkipping++;width=this.mGetZoomedValue(this.thumbImg.width);height=this.mGetZoomedValue(this.thumbImg.height);}
return[width,height];},mGetZoomedValue:function(value){return Math.round(value*(1+(this.zoomFactor*this.mGetSize())));},mGetImageURL:function(){return this.IMAGE_ZOOM_PAGE+this.fileID+'/'+this.mGetSize()+'/'+this.thumbImg.width+'/'+this.thumbImg.height+'/zoom-'+this.fileID+'-'+this.mGetSize()+this.IMAGE_EXT;},mGetSize:function(){return this.size+this.stepSkipping;},mBuildImage:function(image,targetWidth,targetHeight){this.hideChildren($('ZoomDraggableDiv'));if($('h'+this.size)){$('h'+this.size).hide();}
var hEle;if(!$('h'+(this.size-1))){var hEle=$('ActualImageDiv').cloneNode(true);hEle.id='h'+(this.size-1);hEle.align='left';hEle.setStyle({position:'relative',left:'0px',top:'0px'});hEle.className='pointer';$('ZoomDraggableDiv').insertBefore(hEle,$('s'+(this.size)));hEle.childElements().each(function(img){img.setStyle({width:targetWidth+'px',height:targetHeight+'px'});img.id='h'+(this.size-1)+'Img';});}else{var hEle=$('h'+(this.size-1));}
hEle.show();var parent;if($('s'+this.size)){parent=$('s'+this.size);}else{parent=document.createElement('div');Element.extend(parent);parent.id=('s'+this.size);parent.setStyle({position:'absolute',left:'0px',top:'0px',display:'none'});}
$('ZoomDraggableDiv').appendChild(parent);if(this.requestImg){if(!$('s'+this.size+'img')){var imgDiv=document.createElement('div');imgDiv.id='s'+this.size+'img';parent.appendChild(imgDiv);var clearDiv=document.createElement('div');clearDiv.className='clear';parent.appendChild(clearDiv);var img;img=document.createElement('img');Element.extend(img);img.id='s'+this.size+'img';img.width=this.viewport.width;img.height=this.viewport.height;img.setStyle({width:targetWidth+'px',height:targetHeight+'px',display:'block','float':'left'});imgDiv.appendChild(img);this.showSpinner();img.observe('load',function(){zoomFile.observeImgLoad(this.id);});img.src=image;}}else{hEle.hide();}
parent.show();},observeImgLoad:function(eleID){this.hideSpinner();if($('h'+this.size)){$('h'+this.size).hide();}},showZoomHover:function(){if(this.size==0){$("zoom-hover-div").removeClassName('h');}},hideZoomHover:function(){$("zoom-hover-div").addClassName('h');},showSpinner:function(){$("zoom-loading-img").removeClassName('h');},hideSpinner:function(){$("zoom-loading-img").addClassName('h');},hideChildren:function(element){if($(element).hasChildNodes()){var divs=$(element).childNodes;for(var i=0;i<divs.length;i++){divs[i].style.display='none';}}},mSetMove:function(mMove){if(this.size==0){this.move=this.ZOOMIN;}
else if(this.size==this.maxSize){this.move=this.ZOOMOUT;}
else{this.move=mMove;}},setNavigatorData:function(targetWidth,targetHeight){this.navigatorData.ratio.width=(this.navigatorData.img.width/targetWidth);this.navigatorData.ratio.height=(this.navigatorData.img.height/targetHeight);this.navigatorData.box.width=Math.round((this.navigatorData.ratio.width*this.viewport.width));this.navigatorData.box.height=Math.round((this.navigatorData.ratio.height*this.viewport.height));},updateNavigatorLocation:function(){var boxWidth=(this.navigatorData.box.width-(this.navigatorData.box.border*2));var boxHeight=(this.navigatorData.box.height-(this.navigatorData.box.border*2));var navLeft=Math.round((this.currentPos.X*this.navigatorData.ratio.width)-(this.navigatorData.box.width/2));var navTop=Math.round((this.currentPos.Y*this.navigatorData.ratio.height)-(this.navigatorData.box.height/2));$('NavCtrlBox').setStyle({width:boxWidth+'px',height:boxHeight+'px',left:(navLeft+1)+'px',top:(navTop+1)+'px'});this.constraintArea.NavCtrlBox.minX=this.navigatorData.img.width-this.navigatorData.box.width+1;this.constraintArea.NavCtrlBox.minY=this.navigatorData.img.height-this.navigatorData.box.height+1;$('nav-image').setStyle({left:-(navLeft-this.navigatorData.box.border)-3+'px',top:-(navTop-this.navigatorData.box.border)-3+'px'});},disableHighlight:function(ele){if(typeof ele.onselectstart!='undefined'){ele.observe('selectstart',function(){return false;});}else if(typeof ele.style.MozUserSelect!='undefined'){ele.style.MozUserSelect='none';}else{ele.observe('mousedown',function(){return false;});}}};Draggable.prototype.draw=function(point){var pos=Position.cumulativeOffset(this.element);if(this.options.ghosting){var r=Position.realOffset(this.element);pos[0]+=r[0]-Position.deltaX;pos[1]+=r[1]-Position.deltaY;}
var d=this.currentDelta();pos[0]-=d[0];pos[1]-=d[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){pos[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;pos[1]-=this.options.scroll.scrollTop-this.originalScrollTop;}
var p=[0,1].map(function(i){return(point[i]-pos[i]-this.offset[i])}.bind(this));if(this.options.snap){if(Object.isFunction(this.options.snap)){p=this.options.snap(p[0],p[1],this);}else{if(Object.isArray(this.options.snap)){p=p.map(function(v,i){return(v/this.options.snap[i]).round()*this.options.snap[i]}.bind(this))}else{p=p.map(function(v){return(v/this.options.snap).round()*this.options.snap}.bind(this))}}}
var style=this.element.style;if((!this.options.constraint)||(this.options.constraint=='horizontal')){style.left=p[0]+'px';}
if((!this.options.constraint)||(this.options.constraint=='vertical')){style.top=p[1]+'px';}
if(this.options.constraintarea){var eleID=this.element.id;if(p[0]>zoomFile.constraintArea[eleID].minX){style.left=zoomFile.constraintArea[eleID].minX+'px';}
if(p[1]>zoomFile.constraintArea[eleID].minY){style.top=zoomFile.constraintArea[eleID].minY+'px';}
if(p[0]<zoomFile.constraintArea[eleID].maxX*-1){style.left=(zoomFile.constraintArea[eleID].maxX*-1)+'px';}
if(p[1]<zoomFile.constraintArea[eleID].maxY*-1){style.top=(zoomFile.constraintArea[eleID].maxY*-1)+'px';}}
if(style.visibility=='hidden')style.visibility='';}